;; Show opcode

(load "tools/code-walker.yl")

(defun print-opcodes (code)
  (vm-walker code
    (^(c recur)
      (let1 operands (table-get *opcode-table* (car c))
        (write/ss (take (+ 1 (length operands)) c))
        (display "\n")
        nil))))

(defun main (args)
  (files-or-stdin args
                  (^(stream)
                    (awhile (read stream)
                      (print-opcodes it)))))
