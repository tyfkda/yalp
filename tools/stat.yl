;; Show opcode

;(load "code-walker.arc")

(defun print-opcodes (code)
  (vm-walker code
    (^(c recur)
      (let1 operands (table-get *opcode-table* (car c))
        (write/ss (take (+ 1 (len operands)) c))
        (display "\n")))))

(defun main (args)
  (files-or-stdin args
                  (^(stream)
                    (awhile (read stream)
                      (print-opcodes it)))))
