;;;; Utility functions for compiler

(defmacro record (args parm &body body)
  `(apply (^ ,parm ,@body)
          ,args))

(defmacro record-case (x &rest args)
  (let-gensym value
    `(let1 ,value ,x
       (case (car ,value)
         ,@(map (^(e)
                  (let1 key (car e)
                    (if (eq? key 't)
                        e
                      `(,key
                        (record (cdr ,value) ,@(cdr e))))))
                args)))))
